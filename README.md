# Pantheon SAML Integration
This is a Composer plugin that integrates the University of Texas Enterprise Authentication on Pantheon for the UT Drupal Kit.

Full user documentation can be found at https://drupalkit.its.utexas.edu/docs/getting_started/pantheon_setup.html#integrating-enterprise-authentication


## Architectural overview
Getting the University's SAML-based sign-in method (Enterprise Authentication) working with Drupal, on Pantheon, involves a coordination of different components. The following provides a high-level explanation of how the pieces fit together:

1. **[Enterprise Authentication](https://ut.service-now.com/sp?id=ut_bs_service_detail&sys_id=30cb4f61db6c0450838fdee5ce961979)**: the Single Sign On (SSO) system developed and maintained by the University's Information and Access Management (IAM) team that allows applications to use EID-based authentication. It supports Security Assertion Markup Language version 2.0 (SAML 2). In SSO terminology, this acts as the Identity Provider (IdP).
2. **[OneLogin SAML PHP Toolkit](https://github.com/SAML-Toolkits/php-saml)**: a third-party library which provides the business logic to handle SAML requests in PHP. It acts as the Service Provider (SP).
3. **[pantheon_saml_metadata_aggregate](https://github.austin.utexas.edu/eis1-wcs/pantheon_saml_metadata_aggregate)**: This generates an XML file with data about all of the domains that should be eligible for Enterprise Authentication. The IAM team periodically (every 3 hours) checks this for updates.
4. **[pantheon_saml_data](https://github.austin.utexas.edu/eis1-wcs/pantheon_saml_data)**: A certificate and private key. These are provided to IdP as part of the SAML metadata aggregate. The IdP returns the certificate in it authentication response, and the SP verifies that the certificate matches what is in its configuration.
5. **[samlauth](https://drupal.org/project/samlauth)**: A Drupal module that integrates the SAML authorization response into Drupal's authentication system. We also use this module on some sites to do EID-affiliation-based authorization, such as allowing EID holders with the affiliation `current-staff` to receive the Drupal role `staff`.
6. **[pantheon_saml_integration](https://github.austin.utexas.edu/eis1-wcs/pantheon_saml_integration)**: a Composer plugin developed by the WCMS team. This was originally created because symlinks needed to be present for the simpleSAMLphp integration, and that could only be done through a Composer plugin. With the more recent OneLogin integration, the only functional role of this plugin is to provide a `settings.pantheon.saml.php` file, which hardcodes the configuration values needed for integration with Enterprise Authentication. In the future, these settings could potentially be provided in, say, `utexas_saml_auth_helper`, via Config Overrides, and the Composer plugin could be retired.
7. **[utexas_saml_auth_helper](https://github.austin.utexas.edu/eis1-wcs/utexas_saml_auth_helper)**: A Drupal module that provides UI tweaks, such as displaying a sign-in link on /user/login, and enforcing EID-based usernames.